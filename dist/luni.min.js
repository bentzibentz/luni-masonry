/*!
 * luni v0.0.0
 * Copyright (c) 2021-2021 Fabian Bentz
 * License: MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).luni=e()}(this,(function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var r=function(){function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.parent,r=void 0===n?document.querySelector("#luni"):n,o=e.links,a=void 0===o?document.querySelectorAll("[data-luni-link]"):o,s=e.active,l=void 0===s?"is-active":s,u=e.margin,c=void 0===u?20:u,d=e.responsive,h=void 0===d?{980:{columns:3},480:{columns:2},0:{columns:1}}:d,f=e.fadeDuration,m=void 0===f?{in:300,out:0}:f;t(this,i),this.parent=r,this.links=Array.from(a),this.active=l,this.margin=c,this.responsive=h,this.fadeDuration=m,this.elements=Array.from(this.parent.children),this.activeElements=this.elements,this.columns=1,this.dataLink="all",this.winWidth=window.innerWidth,this.init()}var r,o,a;return r=i,o=[{key:"orderElements",value:function(){var t=this,e=this.parent,i=this.activeElements,r=this.columns,o=this.blocWidth,a=this.margin,s=i.reduce((function(e,n,i){var s=t.sumArrHeight(e,r),l=i%r*(o+a),u=i-r>=0?s[i%r]+a*Math.floor(i/r):0;return n.style.transform="translate3d(".concat(l,"px, ").concat(u,"px, 0)"),e.push(n.offsetHeight),e}),[]),l=this.sumArrHeight(s,r),u=Math.max.apply(Math,n(l))+a*(Math.floor(i.length/r)-1);e.style.height="".concat(u,"px")}},{key:"handleFilterClick",value:function(t,e){var n=this;t.preventDefault();var i=this.links,r=this.active;e.dataset.luniLink!==this.dataLink&&(this.dataLink=e.dataset.luniLink,i.forEach((function(t){t.isEqualNode(e)?t.classList.add(r):t.classList.remove(r)})),this.filterElements((function(){n.orderElements()})))}},{key:"resize",value:function(){var t=this;window.addEventListener("resize",(function(){clearTimeout(window.sortableResize),window.sortableResize=setTimeout((function(){t.winWidth=window.innerWidth,t.setBlockWidth((function(){t.orderElements()}))}),500)}))}},{key:"init",value:function(){var t=this,e=this.parent,n=this.links,i=this.active;n.forEach((function(e,n){0===n&&(e.classList.add(i),t.dataLink=e.dataset.luniLink),e.addEventListener("click",(function(n){t.handleFilterClick(n,e)}))})),this.setBlockWidth(),window.addEventListener("load",(function(){t.filterElements((function(){t.orderElements()})),e.style.opacity="1"})),this.resize()}},{key:"setBlockWidth",value:function(t){var e=this.parent,n=this.elements,i=this.margin,r=this.responsive;this.columns=this.columnsCount(r).columns;var o=this.columns;this.blocWidth=(e.clientWidth-i*(o-1))/o;var a=this.blocWidth;n.forEach((function(t){t.style.width="".concat(a,"px")})),t&&t()}},{key:"filterElements",value:function(t){var e=this,n=this.elements,i=this.dataLink,r=this.fadeDuration;this.activeElements=n.filter((function(t){return"all"===i||t.dataset.luniEl.split(",").includes(i)?(e.fadeIn(t,r.in),!0):(e.fadeOut(t,r.out),!1)})),t&&t()}},{key:"sumArrHeight",value:function(t,e){return t.reduce((function(t,n,i){var r=i%e;return t[r]||(t[r]=0),t[r]+=n,t}),[])}},{key:"columnsCount",value:function(t){var e=this.winWidth;return Object.entries(t).reduce((function(t,n){return e>n[0]&&n[0]>=Math.max(t.width)?{width:n[0],columns:n[1].columns}:t}),{width:0,columns:4})}},{key:"fadeIn",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=Number.parseFloat(window.getComputedStyle(t,null).getPropertyValue("opacity")),r=16,o=r/e;function a(){(i+=o)<=1?(t.style.opacity=i,requestAnimationFrame(a)):(t.style.opacity="1",n&&n())}t.style.display="block",requestAnimationFrame(a)}},{key:"fadeOut",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=Number.parseFloat(window.getComputedStyle(t,null).getPropertyValue("opacity")),r=16,o=e?r/e:1;function a(){(i-=o)>=0?(t.style.opacity=i,requestAnimationFrame(a)):(t.style.opacity="0",t.style.display="none",n&&n())}requestAnimationFrame(a)}}],o&&e(r.prototype,o),a&&e(r,a),i}();return r}));
